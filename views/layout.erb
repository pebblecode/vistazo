<!DOCTYPE html>
<html>
<head>
  <meta http-equiv="Content-Type" content="text/html; charset=utf-8"/>
  <title>Vistazo</title>
  
  <link rel="shortcut icon" href="/img/favicon.ico"/>
  
  <link href='http://fonts.googleapis.com/css?family=Cabin:400,700,400italic' rel='stylesheet' type='text/css'>
  <link rel="stylesheet" href="/fonts/fonts.css" type="text/css" />
  <link rel="stylesheet" href="/css/style.css" type="text/css" />
  <% if @projects.present? %>
    <style type="text/css">
      <% for project in @projects %>
        <%= ".#{project.css_class}" %> {
          background-color: <%= "#{project.hex_colour}" %>;
        }
      <% end %>
    </style>
  <% end %>
  
  <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.6.4/jquery.min.js" type="text/javascript"></script>
  <script src="https://ajax.googleapis.com/ajax/libs/jqueryui/1.8.16/jquery-ui.min.js" type="text/javascript"></script>
  <script src="/js/jquery.labelify.js" type="text/javascript"></script>
  <script src="/js/underscore-min.js" type="text/javascript"></script>
  <script src="/js/backbone-min.js" type="text/javascript"></script>
  <script type="text/javascript">
    /*
     * Preload images jQuery plugin
     * http://stackoverflow.com/questions/476679/preloading-images-with-jquery
     *
     */
    $.fn.preload = function() {
      this.each(function(){
        $('<img/>')[0].src = this;
      });
    }
    $(function () {
      // Preload AJAX spinner
      $(['/img/loading.gif']).preload();
    });
  </script>
  <script src="/js/script.js" type="text/javascript"></script>  
</head>
<%
  body_classes = []
  body_classes << 'is-super-admin' if is_super_admin?
  body_classes << 'first-signon' if @first_signon
%>
<body class='<%= body_classes.join(" ") %>'>
  <div id="overlay-bg"></div>
  <div id="help-nav"></div>
  <div id="help-team"></div>
  <div id="top-nav">
    <h1 id="logo"><a href="/">VISTAZO</a></h1> <div class="top-spacer">
    </div> 
    <% if @team.present? %>
      <div id="team-name">
        <h2><%= @team.name %></h2>
      </div>
    <% end %>
    
    <% if is_super_admin? %>
      <ul id="modify-data" style="<%= (settings.environment == "production") ? "display: none" : "" %>">
        <li>
          <form action="/reset" method="post">
            <button name="reset_database" type="submit" value="submit">Reset database</button>
          </form>
        </li>
      </ul>
    <% end %>
    
    
    <!-- <p class="top-symbols">U</p> 
    <div class="top-spacer right"></div> 
    <p class="top-symbols">S</p>
    <div class="top-spacer right"></div>
    <div class="top-spacer right"></div> -->
    <ul class="action-bar">
      <% if logged_in? %>
        <li><a href="/logout" title="Log out">X</a></li>
        <li><a class="user-settings" href="#" title="User settings">U</a></li>
        <li><a class="help" title="Help" href="#">?</a></li>
        <li class="logged-in-as"><%= current_user.name %></li>
      <% end %>
    </ul>
    <!-- <p class="invite-user"><a href="#team-users">Invite people to view this team</a></p> -->
  </div>
  
  <%= styled_flash %>
  
  <div id="main">
    <%= yield %>
  </div>
  
  <% if @show_users %>
    <%= erb :users %>
  <% end %>
  <%= erb :team_name_dialog %>
  
  <footer>
    <ul>
      <li><span>Vistazo Alpha</span> <%= settings.version_string %></li>
      <li>Created by <a href="http://pebblecode.com/">pebble {code}</a></li>
      <!--<li><a href="#">get satisfaction / UX testing link</a></li>-->
    </ul>
  </footer>

  <% unless @is_error %>
    <%= erb :_js_templates %>
  <% end %>
  <script>
    var projectDialogView = new ProjectDialogView({el: "body"});

    teamProjects.reset(<%= @projects.to_json %>);

    // Initialise team members
    var teamMemberView = new TeamMemberView({el: $('#week-view')});
    teamMembers.reset(<%= @team_members.to_json %>);
    teamMembers.each(function(tm) {
      teamMemberView.render(tm);
    });
  </script>
</body>
